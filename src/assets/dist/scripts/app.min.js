!function e(t,n,r){function o(u,a){if(!n[u]){if(!t[u]){var c="function"==typeof require&&require;if(!a&&c)return c(u,!0);if(i)return i(u,!0);var s=new Error("Cannot find module '"+u+"'");throw s.code="MODULE_NOT_FOUND",s}var l=n[u]={exports:{}};t[u][0].call(l.exports,function(e){var n=t[u][1][e];return o(n?n:e)},l,l.exports,e,t,n,r)}return n[u].exports}for(var i="function"==typeof require&&require,u=0;u<r.length;u++)o(r[u]);return o}({1:[function(e,t,n){"use strict";function r(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}function o(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":"undefined"==typeof e?"undefined":r(e)}function i(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":"undefined"==typeof e?"undefined":o(e)}function u(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":"undefined"==typeof e?"undefined":i(e)}function a(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":"undefined"==typeof e?"undefined":u(e)}function c(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":"undefined"==typeof e?"undefined":a(e)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(n,"__esModule",{value:!0}),n.IntentAnalytics=void 0;var f=e("./counters/GoogleAnalytics"),y=e("./counters/YandexMetrika"),d=function(){function e(){s(this,e),this.defaultOptions()}return l(e,[{key:"defaultOptions",value:function(){this.countersList={},this.actionQueue={}}},{key:"init",value:function(t){for(var n in t)if(t.hasOwnProperty(n)!==!1){var r=t[n],o=e.createCounter(r,n);null!==o&&(this.countersList[n]=o)}}},{key:"addToQueue",value:function(e,t,n){"object"!==c(this.actionQueue[e])&&(this.actionQueue[e]=[]),this.actionQueue[e].push({functionName:t,argument:n})}},{key:"checkUnhandled",value:function(){for(var t in this.actionQueue)if(this.actionQueue.hasOwnProperty(t)&&"object"===c(this.actionQueue[t])&&this.countersList.hasOwnProperty(t)&&null!==this.countersList[t].counter){var n=this.countersList[t],r=!0,o=!1,i=void 0;try{for(var u,a=this.actionQueue[t][Symbol.iterator]();!(r=(u=a.next()).done);r=!0){var s=u.value,l=s.functionName,f=s.argument;try{n[l](f)}catch(y){e.logError("Exception during queued "+l+" call: "+JSON.stringify(y))}}}catch(d){o=!0,i=d}finally{try{!r&&a["return"]&&a["return"]()}finally{if(o)throw i}}this.actionQueue[t]=!1}}},{key:"track",value:function(t){this.checkUnhandled();for(var n in t)if(t.hasOwnProperty(n)!==!1){var r=t[n];if(null===this.countersList[n].counter)this.addToQueue(n,"track",r);else if(this.countersList.hasOwnProperty(n))try{this.countersList[n].track(r)}catch(o){e.logError("Exception during track call: "+JSON.stringify(o))}}}},{key:"sendVariables",value:function(t){this.checkUnhandled();for(var n in this.countersList)if(this.countersList.hasOwnProperty(n)!==!1){var r=this.countersList[n];null===r.counter&&this.addToQueue(n,"sendVariables",t);try{r.sendVariables(t)}catch(o){e.logError("Exception during sendVariables call: "+JSON.stringify(o))}}}}],[{key:"createCounter",value:function(e,t){switch(t){case"GoogleAnalytics":return new f.GoogleAnalytics(e.javascriptObjectName,e);case"YandexMetrika":return new y.YandexMetrika(e.javascriptObjectName,e);default:return null}}},{key:"logError",value:function(e){"undefined"!=typeof console&&console.log(e)}}]),e}();n.IntentAnalytics=d},{"./counters/GoogleAnalytics":4,"./counters/YandexMetrika":5}],2:[function(e,t,n){(function(t){"use strict";var n=e("./IntentAnalytics");t.intentAnalytics=new n.IntentAnalytics}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./IntentAnalytics":1}],3:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(t,n){r(this,e),this.javascriptObjectName=t}return o(e,[{key:"track",value:function(e){}},{key:"sendVariables",value:function(e){}},{key:"counter",get:function(){return e.getCounterObject(this.javascriptObjectName)}}],[{key:"getCounterObject",value:function(e){return window[e]||null}}]),e}();n.AbstractCounter=i},{}],4:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(n,"__esModule",{value:!0}),n.GoogleAnalytics=void 0;var a=e("./AbstractCounter"),c=e("../IntentAnalytics"),s=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?"ga":arguments[0],n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];r(this,t);var i=o(this,Object.getPrototypeOf(t).call(this,e,n));return i.trackerName=n.trackerName||"",i}return i(t,e),u(t,[{key:"track",value:function(e){if("undefined"==typeof e.action)return void c.IntentAnalytics.logError("No action supplied for GoogleAnalytics.track: "+JSON.stringify(e));var t=this.trackerSendPrefix+"send";this.counter(t,{hitType:"event",eventCategory:e.category||"common",eventAction:e.action,eventLabel:e.label||void 0,eventValue:e.value||void 0})}},{key:"sendVariables",value:function(e){this.counter(this.trackerSendPrefix+"set",e)}},{key:"trackerSendPrefix",get:function(){return this.trackerName||""}}]),t}(a.AbstractCounter);n.GoogleAnalytics=s},{"../IntentAnalytics":1,"./AbstractCounter":3}],5:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(n,"__esModule",{value:!0}),n.YandexMetrika=void 0;var a=e("./AbstractCounter"),c=e("../IntentAnalytics"),s=function(e){function t(e,n){return r(this,t),o(this,Object.getPrototypeOf(t).call(this,e,n))}return i(t,e),u(t,[{key:"track",value:function(e){return"undefined"==typeof e.goal?void c.IntentAnalytics.logError("No goal supplied for YandexMetrika.track: "+JSON.stringify(e)):void this.counter.reachGoal(e.goal,e.params||{})}},{key:"sendVariables",value:function(e){this.counter.params(e)}}]),t}(a.AbstractCounter);n.YandexMetrika=s},{"../IntentAnalytics":1,"./AbstractCounter":3}]},{},[2]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJhcHAuanMiLCJqcy9JbnRlbnRBbmFseXRpY3MuanMiLCJqcy9hcHAuanMiLCJqcy9jb3VudGVycy9BYnN0cmFjdENvdW50ZXIuanMiLCJqcy9jb3VudGVycy9Hb29nbGVBbmFseXRpY3MuanMiLCJqcy9jb3VudGVycy9ZYW5kZXhNZXRyaWthLmpzIl0sIm5hbWVzIjpbImUiLCJ0IiwibiIsInIiLCJzIiwibyIsInUiLCJhIiwicmVxdWlyZSIsImkiLCJmIiwiRXJyb3IiLCJjb2RlIiwibCIsImV4cG9ydHMiLCJjYWxsIiwibGVuZ3RoIiwxLCJtb2R1bGUiLCJfdHlwZW9mNiIsIm9iaiIsIlN5bWJvbCIsImNvbnN0cnVjdG9yIiwiX3R5cGVvZjUiLCJfdHlwZW9mNCIsIl90eXBlb2YzIiwiX3R5cGVvZjIiLCJfdHlwZW9mIiwiX2NsYXNzQ2FsbENoZWNrIiwiaW5zdGFuY2UiLCJDb25zdHJ1Y3RvciIsIlR5cGVFcnJvciIsIl9jcmVhdGVDbGFzcyIsImRlZmluZVByb3BlcnRpZXMiLCJ0YXJnZXQiLCJwcm9wcyIsImRlc2NyaXB0b3IiLCJlbnVtZXJhYmxlIiwiY29uZmlndXJhYmxlIiwid3JpdGFibGUiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImtleSIsInByb3RvUHJvcHMiLCJzdGF0aWNQcm9wcyIsInByb3RvdHlwZSIsInZhbHVlIiwiSW50ZW50QW5hbHl0aWNzIiwidW5kZWZpbmVkIiwiX0dvb2dsZUFuYWx5dGljcyIsIl9ZYW5kZXhNZXRyaWthIiwidGhpcyIsImRlZmF1bHRPcHRpb25zIiwiY291bnRlcnNMaXN0IiwiYWN0aW9uUXVldWUiLCJjb3VudGVyVHlwZSIsImhhc093blByb3BlcnR5IiwiY291bnRlciIsImNvdW50ZXJDbGFzcyIsImNyZWF0ZUNvdW50ZXIiLCJmdW5jdGlvbk5hbWUiLCJhcmd1bWVudCIsInB1c2giLCJfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uIiwiX2RpZEl0ZXJhdG9yRXJyb3IiLCJfaXRlcmF0b3JFcnJvciIsIl9zdGVwIiwiX2l0ZXJhdG9yIiwiaXRlcmF0b3IiLCJuZXh0IiwiZG9uZSIsInF1ZXVlSXRlbSIsImxvZ0Vycm9yIiwiSlNPTiIsInN0cmluZ2lmeSIsImVyciIsImNvdW50ZXJzSW5zdHJ1Y3Rpb25zIiwiY2hlY2tVbmhhbmRsZWQiLCJpbnN0cnVjdGlvbiIsImFkZFRvUXVldWUiLCJ0cmFjayIsInZhcmlhYmxlcyIsInNlbmRWYXJpYWJsZXMiLCJHb29nbGVBbmFseXRpY3MiLCJqYXZhc2NyaXB0T2JqZWN0TmFtZSIsIllhbmRleE1ldHJpa2EiLCJtZXNzYWdlIiwiY29uc29sZSIsImxvZyIsIi4vY291bnRlcnMvR29vZ2xlQW5hbHl0aWNzIiwiLi9jb3VudGVycy9ZYW5kZXhNZXRyaWthIiwyLCJnbG9iYWwiLCJfSW50ZW50QW5hbHl0aWNzIiwiaW50ZW50QW5hbHl0aWNzIiwic2VsZiIsIndpbmRvdyIsIi4vSW50ZW50QW5hbHl0aWNzIiwzLCJBYnN0cmFjdENvdW50ZXIiLCJwYXJhbXMiLCJnZXQiLCJnZXRDb3VudGVyT2JqZWN0Iiw0LCJfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybiIsIlJlZmVyZW5jZUVycm9yIiwiX2luaGVyaXRzIiwic3ViQ2xhc3MiLCJzdXBlckNsYXNzIiwiY3JlYXRlIiwic2V0UHJvdG90eXBlT2YiLCJfX3Byb3RvX18iLCJfQWJzdHJhY3RDb3VudGVyMiIsIl9BYnN0cmFjdENvdW50ZXIiLCJhcmd1bWVudHMiLCJfdGhpcyIsImdldFByb3RvdHlwZU9mIiwidHJhY2tlck5hbWUiLCJhY3Rpb24iLCJ0cmFja2VyU2VuZFByZWZpeCIsImhpdFR5cGUiLCJldmVudENhdGVnb3J5IiwiY2F0ZWdvcnkiLCJldmVudEFjdGlvbiIsImV2ZW50TGFiZWwiLCJsYWJlbCIsImV2ZW50VmFsdWUiLCIuLi9JbnRlbnRBbmFseXRpY3MiLCIuL0Fic3RyYWN0Q291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Y0FBZSxFQUFVLFNBQVdGLEtBQVlBLEVBQVdHLFVBQVcsR0FBTUMsT0FBT0MsZUFBZVAsRUFBUUUsRUFBV00sSUFBS04sSUFBaUIsTUFBTyxVQUFVTixFQUFhYSxFQUFZQyxHQUFpSixNQUE5SEQsSUFBWVYsRUFBaUJILEVBQVllLFVBQVdGLEdBQWlCQyxHQUFhWCxFQUFpQkgsRUFBYWMsR0FBcUJkLEtBRWppQlUsUUFBT0MsZUFBZTNCLEVBQVMsY0FDN0JnQyxPQUFPLElBRVRoQyxFQUFRdUUsY0FBZ0JyQyxNQUV4QixJQUFJZ0UsR0FBb0J4RyxFQUFRLHFCQUU1QnFGLEVBQW1CckYsRUFBUSxzQktoV3pCNkUsRUFBYSxTQUFBNEIsR0FDakIsUUFESTVCLEdBQ1FELEVBQXNCZ0IsR0w2V2hDLE1BRkF4RSxHQUFnQnVCLEtLNVdka0MsR0w4V0ttQixFQUEyQnJELEtBQU1YLE9BQU80RSxlSzlXN0MvQixHQUFhdEUsS0FBQW9DLEtBRVRpQyxFQUFzQmdCLElMK1g5QixNQXhCQU0sR0t6V0lyQixFQUFhNEIsR0xpWGpCakYsRUtqWElxRCxJTGtYRjNDLElBQUssUUFDTEksTUFBTyxTSzlXSHNELEdBQ0osTUFBNEIsbUJBQWpCQSxHQUFPOEIsU0FDaEJyQyxHQVRFOUMsZ0JBU2N5QixTQUFTLDZDQUErQ0MsS0FBS0MsVUFBVTBCLFFBR3pGakQsTUFBS00sUUFBUTBFLFVBQ1gvQixFQUFPOEIsS0FDUDlCLEVBQU9BLGVMK1dUMUQsSUFBSyxnQkFDTEksTUFBTyxTSzVXS21DLEdBQ1o5QixLQUFLTSxRQUFRMkMsT0FBT25CLE9BakJsQkksR0xrWUgyQixFS3JZS2IsZ0JMdVlSckYsR0svV1F1RSxjQUFBQSxJTGlYTDBDLHFCQUFxQixFQUFFQyxvQkFBb0IsU0FBUyIsImZpbGUiOiJhcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pKHsxOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXtcbid1c2Ugc3RyaWN0JztcblxuZnVuY3Rpb24gX3R5cGVvZjYob2JqKSB7IHJldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCAhPT0gXCJ1bmRlZmluZWRcIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCA/IFwic3ltYm9sXCIgOiB0eXBlb2Ygb2JqOyB9XG5cbmZ1bmN0aW9uIF90eXBlb2Y1KG9iaikge1xuICByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgIT09IFwidW5kZWZpbmVkXCIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgPyBcInN5bWJvbFwiIDogdHlwZW9mIG9iaiA9PT0gXCJ1bmRlZmluZWRcIiA/IFwidW5kZWZpbmVkXCIgOiBfdHlwZW9mNihvYmopO1xufVxuXG5mdW5jdGlvbiBfdHlwZW9mNChvYmopIHtcbiAgcmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sICE9PSBcInVuZGVmaW5lZFwiICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sID8gXCJzeW1ib2xcIiA6IHR5cGVvZiBvYmogPT09IFwidW5kZWZpbmVkXCIgPyBcInVuZGVmaW5lZFwiIDogX3R5cGVvZjUob2JqKTtcbn1cblxuZnVuY3Rpb24gX3R5cGVvZjMob2JqKSB7XG4gIHJldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCAhPT0gXCJ1bmRlZmluZWRcIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCA/IFwic3ltYm9sXCIgOiB0eXBlb2Ygb2JqID09PSBcInVuZGVmaW5lZFwiID8gXCJ1bmRlZmluZWRcIiA6IF90eXBlb2Y0KG9iaik7XG59XG5cbmZ1bmN0aW9uIF90eXBlb2YyKG9iaikge1xuICByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgIT09IFwidW5kZWZpbmVkXCIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgPyBcInN5bWJvbFwiIDogdHlwZW9mIG9iaiA9PT0gXCJ1bmRlZmluZWRcIiA/IFwidW5kZWZpbmVkXCIgOiBfdHlwZW9mMyhvYmopO1xufVxuXG52YXIgX2NyZWF0ZUNsYXNzID0gKGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTtkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7ZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlO2lmIChcInZhbHVlXCIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7T2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpO1xuICAgIH1cbiAgfXJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7XG4gICAgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTtpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTtyZXR1cm4gQ29uc3RydWN0b3I7XG4gIH07XG59KSgpO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuZXhwb3J0cy5JbnRlbnRBbmFseXRpY3MgPSB1bmRlZmluZWQ7XG5cbnZhciBfR29vZ2xlQW5hbHl0aWNzID0gcmVxdWlyZSgnLi9jb3VudGVycy9Hb29nbGVBbmFseXRpY3MnKTtcblxudmFyIF9ZYW5kZXhNZXRyaWthID0gcmVxdWlyZSgnLi9jb3VudGVycy9ZYW5kZXhNZXRyaWthJyk7XG5cbmZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7XG4gIHJldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCAhPT0gXCJ1bmRlZmluZWRcIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCA/IFwic3ltYm9sXCIgOiB0eXBlb2Ygb2JqID09PSBcInVuZGVmaW5lZFwiID8gXCJ1bmRlZmluZWRcIiA6IF90eXBlb2YyKG9iaik7XG59XG5cbmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHtcbiAgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHtcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uXCIpO1xuICB9XG59XG5cbnZhciBJbnRlbnRBbmFseXRpY3MgPSAoZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBJbnRlbnRBbmFseXRpY3MoKSB7XG4gICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIEludGVudEFuYWx5dGljcyk7XG5cbiAgICB0aGlzLmRlZmF1bHRPcHRpb25zKCk7XG4gIH1cblxuICBfY3JlYXRlQ2xhc3MoSW50ZW50QW5hbHl0aWNzLCBbe1xuICAgIGtleTogJ2RlZmF1bHRPcHRpb25zJyxcbiAgICB2YWx1ZTogZnVuY3Rpb24gZGVmYXVsdE9wdGlvbnMoKSB7XG4gICAgICB0aGlzLmNvdW50ZXJzTGlzdCA9IHt9O1xuICAgICAgdGhpcy5hY3Rpb25RdWV1ZSA9IHt9O1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogJ2luaXQnLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBpbml0KGNvdW50ZXJzTGlzdCkge1xuICAgICAgZm9yICh2YXIgY291bnRlclR5cGUgaW4gY291bnRlcnNMaXN0KSB7XG4gICAgICAgIGlmIChjb3VudGVyc0xpc3QuaGFzT3duUHJvcGVydHkoY291bnRlclR5cGUpID09PSBmYWxzZSkge1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIHZhciBjb3VudGVyID0gY291bnRlcnNMaXN0W2NvdW50ZXJUeXBlXTtcbiAgICAgICAgdmFyIGNvdW50ZXJDbGFzcyA9IEludGVudEFuYWx5dGljcy5jcmVhdGVDb3VudGVyKGNvdW50ZXIsIGNvdW50ZXJUeXBlKTtcbiAgICAgICAgaWYgKGNvdW50ZXJDbGFzcyAhPT0gbnVsbCkge1xuICAgICAgICAgIHRoaXMuY291bnRlcnNMaXN0W2NvdW50ZXJUeXBlXSA9IGNvdW50ZXJDbGFzcztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSwge1xuICAgIGtleTogJ2FkZFRvUXVldWUnLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBhZGRUb1F1ZXVlKGNvdW50ZXJUeXBlLCBmdW5jdGlvbk5hbWUsIGFyZ3VtZW50KSB7XG4gICAgICBpZiAoX3R5cGVvZih0aGlzLmFjdGlvblF1ZXVlW2NvdW50ZXJUeXBlXSkgIT09ICdvYmplY3QnKSB7XG4gICAgICAgIHRoaXMuYWN0aW9uUXVldWVbY291bnRlclR5cGVdID0gW107XG4gICAgICB9XG4gICAgICB0aGlzLmFjdGlvblF1ZXVlW2NvdW50ZXJUeXBlXS5wdXNoKHtcbiAgICAgICAgJ2Z1bmN0aW9uTmFtZSc6IGZ1bmN0aW9uTmFtZSxcbiAgICAgICAgJ2FyZ3VtZW50JzogYXJndW1lbnRcbiAgICAgIH0pO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogJ2NoZWNrVW5oYW5kbGVkJyxcbiAgICB2YWx1ZTogZnVuY3Rpb24gY2hlY2tVbmhhbmRsZWQoKSB7XG4gICAgICBmb3IgKHZhciBjb3VudGVyVHlwZSBpbiB0aGlzLmFjdGlvblF1ZXVlKSB7XG4gICAgICAgIGlmICh0aGlzLmFjdGlvblF1ZXVlLmhhc093blByb3BlcnR5KGNvdW50ZXJUeXBlKSAmJiBfdHlwZW9mKHRoaXMuYWN0aW9uUXVldWVbY291bnRlclR5cGVdKSA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAvLyAuY291bnRlciBnZXR0ZXIgd2lsbCBjaGVjayBpZiBjb3VudGVyIGdsb2JhbCBvYmplY3QoaWUuIGdhLCB5YUNvdW50ZXIpIG5vdyBleGlzdHNcbiAgICAgICAgICBpZiAodGhpcy5jb3VudGVyc0xpc3QuaGFzT3duUHJvcGVydHkoY291bnRlclR5cGUpICYmIHRoaXMuY291bnRlcnNMaXN0W2NvdW50ZXJUeXBlXS5jb3VudGVyICE9PSBudWxsKSB7XG4gICAgICAgICAgICAvLyBsb29wIHRocm91Z2ggYWxsIHF1ZXVlSXRlbXMgb2YgdGhpcyBjb3VudGVyXG4gICAgICAgICAgICB2YXIgY291bnRlckNsYXNzID0gdGhpcy5jb3VudGVyc0xpc3RbY291bnRlclR5cGVdO1xuICAgICAgICAgICAgdmFyIF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gPSB0cnVlO1xuICAgICAgICAgICAgdmFyIF9kaWRJdGVyYXRvckVycm9yID0gZmFsc2U7XG4gICAgICAgICAgICB2YXIgX2l0ZXJhdG9yRXJyb3IgPSB1bmRlZmluZWQ7XG5cbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgIGZvciAodmFyIF9pdGVyYXRvciA9IHRoaXMuYWN0aW9uUXVldWVbY291bnRlclR5cGVdW1N5bWJvbC5pdGVyYXRvcl0oKSwgX3N0ZXA7ICEoX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiA9IChfc3RlcCA9IF9pdGVyYXRvci5uZXh0KCkpLmRvbmUpOyBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uID0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgIHZhciBxdWV1ZUl0ZW0gPSBfc3RlcC52YWx1ZTtcblxuICAgICAgICAgICAgICAgIHZhciBmdW5jdGlvbk5hbWUgPSBxdWV1ZUl0ZW0uZnVuY3Rpb25OYW1lO1xuICAgICAgICAgICAgICAgIHZhciBhcmd1bWVudCA9IHF1ZXVlSXRlbS5hcmd1bWVudDtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgY291bnRlckNsYXNzW2Z1bmN0aW9uTmFtZV0oYXJndW1lbnQpO1xuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgIEludGVudEFuYWx5dGljcy5sb2dFcnJvcignRXhjZXB0aW9uIGR1cmluZyBxdWV1ZWQgJyArIGZ1bmN0aW9uTmFtZSArICcgY2FsbDogJyArIEpTT04uc3RyaW5naWZ5KGUpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgLy8gZGlzYWJsZSBxdWV1ZSBmb3IgdGhpcyBjb3VudGVyIGFzIGl0IGlzIG5vdCBuZWVkZWQgYW55bW9yZVxuICAgICAgICAgICAgICAvLyBhbGwgbmV4dCBjYWxscyB0byB0aGlzIGNvdW50ZXIgc2hvdWxkIGJlIGhhbmRsZWQgb2tcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgICBfZGlkSXRlcmF0b3JFcnJvciA9IHRydWU7XG4gICAgICAgICAgICAgIF9pdGVyYXRvckVycm9yID0gZXJyO1xuICAgICAgICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBpZiAoIV9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gJiYgX2l0ZXJhdG9yLnJldHVybikge1xuICAgICAgICAgICAgICAgICAgX2l0ZXJhdG9yLnJldHVybigpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgICAgICAgICBpZiAoX2RpZEl0ZXJhdG9yRXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgIHRocm93IF9pdGVyYXRvckVycm9yO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLmFjdGlvblF1ZXVlW2NvdW50ZXJUeXBlXSA9IGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSwge1xuICAgIGtleTogJ3RyYWNrJyxcbiAgICB2YWx1ZTogZnVuY3Rpb24gdHJhY2soY291bnRlcnNJbnN0cnVjdGlvbnMpIHtcbiAgICAgIHRoaXMuY2hlY2tVbmhhbmRsZWQoKTtcbiAgICAgIGZvciAodmFyIGNvdW50ZXJUeXBlIGluIGNvdW50ZXJzSW5zdHJ1Y3Rpb25zKSB7XG4gICAgICAgIGlmIChjb3VudGVyc0luc3RydWN0aW9ucy5oYXNPd25Qcm9wZXJ0eShjb3VudGVyVHlwZSkgPT09IGZhbHNlKSB7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgaW5zdHJ1Y3Rpb24gPSBjb3VudGVyc0luc3RydWN0aW9uc1tjb3VudGVyVHlwZV07XG4gICAgICAgIGlmICh0aGlzLmNvdW50ZXJzTGlzdFtjb3VudGVyVHlwZV0uY291bnRlciA9PT0gbnVsbCkge1xuICAgICAgICAgIC8vIGlmIGdsb2JhbCBqcyBvYmplY3Qgb2YgY291bnRlciBpcyBub3QgbG9hZGVkIC0gdGhpcyB3aWxsIGFkZCBpdCB0byBxdWV1ZVxuICAgICAgICAgIHRoaXMuYWRkVG9RdWV1ZShjb3VudGVyVHlwZSwgJ3RyYWNrJywgaW5zdHJ1Y3Rpb24pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmICh0aGlzLmNvdW50ZXJzTGlzdC5oYXNPd25Qcm9wZXJ0eShjb3VudGVyVHlwZSkpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgIHRoaXMuY291bnRlcnNMaXN0W2NvdW50ZXJUeXBlXS50cmFjayhpbnN0cnVjdGlvbik7XG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgIEludGVudEFuYWx5dGljcy5sb2dFcnJvcignRXhjZXB0aW9uIGR1cmluZyB0cmFjayBjYWxsOiAnICsgSlNPTi5zdHJpbmdpZnkoZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSwge1xuICAgIGtleTogJ3NlbmRWYXJpYWJsZXMnLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBzZW5kVmFyaWFibGVzKHZhcmlhYmxlcykge1xuICAgICAgdGhpcy5jaGVja1VuaGFuZGxlZCgpO1xuICAgICAgZm9yICh2YXIgY291bnRlclR5cGUgaW4gdGhpcy5jb3VudGVyc0xpc3QpIHtcbiAgICAgICAgaWYgKHRoaXMuY291bnRlcnNMaXN0Lmhhc093blByb3BlcnR5KGNvdW50ZXJUeXBlKSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgY291bnRlciA9IHRoaXMuY291bnRlcnNMaXN0W2NvdW50ZXJUeXBlXTtcbiAgICAgICAgaWYgKGNvdW50ZXIuY291bnRlciA9PT0gbnVsbCkge1xuICAgICAgICAgIHRoaXMuYWRkVG9RdWV1ZShjb3VudGVyVHlwZSwgJ3NlbmRWYXJpYWJsZXMnLCB2YXJpYWJsZXMpO1xuICAgICAgICB9XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY291bnRlci5zZW5kVmFyaWFibGVzKHZhcmlhYmxlcyk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICBJbnRlbnRBbmFseXRpY3MubG9nRXJyb3IoJ0V4Y2VwdGlvbiBkdXJpbmcgc2VuZFZhcmlhYmxlcyBjYWxsOiAnICsgSlNPTi5zdHJpbmdpZnkoZSkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XSwgW3tcbiAgICBrZXk6ICdjcmVhdGVDb3VudGVyJyxcbiAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlQ291bnRlcihjb3VudGVyLCBjb3VudGVyVHlwZSkge1xuICAgICAgc3dpdGNoIChjb3VudGVyVHlwZSkge1xuICAgICAgICBjYXNlICdHb29nbGVBbmFseXRpY3MnOlxuICAgICAgICAgIHJldHVybiBuZXcgX0dvb2dsZUFuYWx5dGljcy5Hb29nbGVBbmFseXRpY3MoY291bnRlci5qYXZhc2NyaXB0T2JqZWN0TmFtZSwgY291bnRlcik7XG4gICAgICAgIGNhc2UgJ1lhbmRleE1ldHJpa2EnOlxuICAgICAgICAgIHJldHVybiBuZXcgX1lhbmRleE1ldHJpa2EuWWFuZGV4TWV0cmlrYShjb3VudGVyLmphdmFzY3JpcHRPYmplY3ROYW1lLCBjb3VudGVyKTtcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6ICdsb2dFcnJvcicsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGxvZ0Vycm9yKG1lc3NhZ2UpIHtcbiAgICAgIC8qZXNsaW50LWRpc2FibGUgKi9cbiAgICAgIGlmICh0eXBlb2YgY29uc29sZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgY29uc29sZS5sb2cobWVzc2FnZSk7XG4gICAgICB9XG4gICAgICAvKmVzbGludC1lbmFibGUqL1xuICAgIH1cbiAgfV0pO1xuXG4gIHJldHVybiBJbnRlbnRBbmFseXRpY3M7XG59KSgpO1xuXG5leHBvcnRzLkludGVudEFuYWx5dGljcyA9IEludGVudEFuYWx5dGljcztcblxufSx7XCIuL2NvdW50ZXJzL0dvb2dsZUFuYWx5dGljc1wiOjQsXCIuL2NvdW50ZXJzL1lhbmRleE1ldHJpa2FcIjo1fV0sMjpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7XG4oZnVuY3Rpb24gKGdsb2JhbCl7XG4ndXNlIHN0cmljdCc7XG5cbnZhciBfSW50ZW50QW5hbHl0aWNzID0gcmVxdWlyZSgnLi9JbnRlbnRBbmFseXRpY3MnKTtcblxuZ2xvYmFsLmludGVudEFuYWx5dGljcyA9IG5ldyBfSW50ZW50QW5hbHl0aWNzLkludGVudEFuYWx5dGljcygpO1xuXG59KS5jYWxsKHRoaXMsdHlwZW9mIGdsb2JhbCAhPT0gXCJ1bmRlZmluZWRcIiA/IGdsb2JhbCA6IHR5cGVvZiBzZWxmICE9PSBcInVuZGVmaW5lZFwiID8gc2VsZiA6IHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgPyB3aW5kb3cgOiB7fSlcblxufSx7XCIuL0ludGVudEFuYWx5dGljc1wiOjF9XSwzOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXtcblwidXNlIHN0cmljdFwiO1xuXG52YXIgX2NyZWF0ZUNsYXNzID0gKGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTtkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7ZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlO2lmIChcInZhbHVlXCIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7T2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpO1xuICAgIH1cbiAgfXJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7XG4gICAgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTtpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTtyZXR1cm4gQ29uc3RydWN0b3I7XG4gIH07XG59KSgpO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuXG5mdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7XG4gIGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvblwiKTtcbiAgfVxufVxuXG52YXIgQWJzdHJhY3RDb3VudGVyID0gKGZ1bmN0aW9uICgpIHtcbiAgLy8gSGVyZSB3ZSB0dXJuIG9mZiBuby11bnVzZWQtdmFycyB3YXJuaW5nIGJlY2F1c2UgdGhpcyBjbGFzcyBpcyBhY3R1YWxseSBhYnN0cmFjdC5cbiAgLy8gU28gdGhlcmUncyBhIGxvdCBvZiB1bnVzZWQgdmFycyBhbmQgaXQgaXMgbm9ybWFsIC0gd2UganVzdCB3YW50IHRvIGRlc2NyaWJlIHRoZSB3aG9sZSBpbnRlcmZhY2UuXG4gIC8qIGVzbGludCBuby11bnVzZWQtdmFyczogMCovXG5cbiAgZnVuY3Rpb24gQWJzdHJhY3RDb3VudGVyKGphdmFzY3JpcHRPYmplY3ROYW1lLCBwYXJhbXMpIHtcbiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgQWJzdHJhY3RDb3VudGVyKTtcblxuICAgIHRoaXMuamF2YXNjcmlwdE9iamVjdE5hbWUgPSBqYXZhc2NyaXB0T2JqZWN0TmFtZTtcbiAgfVxuXG4gIF9jcmVhdGVDbGFzcyhBYnN0cmFjdENvdW50ZXIsIFt7XG4gICAga2V5OiBcInRyYWNrXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHRyYWNrKHBhcmFtcykge31cbiAgfSwge1xuICAgIGtleTogXCJzZW5kVmFyaWFibGVzXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHNlbmRWYXJpYWJsZXModmFyaWFibGVzKSB7fVxuICB9LCB7XG4gICAga2V5OiBcImNvdW50ZXJcIixcbiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgIHJldHVybiBBYnN0cmFjdENvdW50ZXIuZ2V0Q291bnRlck9iamVjdCh0aGlzLmphdmFzY3JpcHRPYmplY3ROYW1lKTtcbiAgICB9XG4gIH1dLCBbe1xuICAgIGtleTogXCJnZXRDb3VudGVyT2JqZWN0XCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGdldENvdW50ZXJPYmplY3QoamF2YXNjcmlwdE9iamVjdE5hbWUpIHtcbiAgICAgIHJldHVybiB3aW5kb3dbamF2YXNjcmlwdE9iamVjdE5hbWVdIHx8IG51bGw7XG4gICAgfVxuICB9XSk7XG5cbiAgcmV0dXJuIEFic3RyYWN0Q291bnRlcjtcbn0pKCk7XG5cbmV4cG9ydHMuQWJzdHJhY3RDb3VudGVyID0gQWJzdHJhY3RDb3VudGVyO1xuXG59LHt9XSw0OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXtcbid1c2Ugc3RyaWN0JztcblxudmFyIF9jcmVhdGVDbGFzcyA9IChmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoXCJ2YWx1ZVwiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KSgpO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuZXhwb3J0cy5Hb29nbGVBbmFseXRpY3MgPSB1bmRlZmluZWQ7XG5cbnZhciBfQWJzdHJhY3RDb3VudGVyMiA9IHJlcXVpcmUoJy4vQWJzdHJhY3RDb3VudGVyJyk7XG5cbnZhciBfSW50ZW50QW5hbHl0aWNzID0gcmVxdWlyZSgnLi4vSW50ZW50QW5hbHl0aWNzJyk7XG5cbmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvblwiKTsgfSB9XG5cbmZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHsgaWYgKCFzZWxmKSB7IHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcihcInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZFwiKTsgfSByZXR1cm4gY2FsbCAmJiAodHlwZW9mIGNhbGwgPT09IFwib2JqZWN0XCIgfHwgdHlwZW9mIGNhbGwgPT09IFwiZnVuY3Rpb25cIikgPyBjYWxsIDogc2VsZjsgfVxuXG5mdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSBcImZ1bmN0aW9uXCIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKFwiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCBcIiArIHR5cGVvZiBzdXBlckNsYXNzKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCBlbnVtZXJhYmxlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LnNldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKSA6IHN1YkNsYXNzLl9fcHJvdG9fXyA9IHN1cGVyQ2xhc3M7IH1cblxudmFyIEdvb2dsZUFuYWx5dGljcyA9IChmdW5jdGlvbiAoX0Fic3RyYWN0Q291bnRlcikge1xuICBfaW5oZXJpdHMoR29vZ2xlQW5hbHl0aWNzLCBfQWJzdHJhY3RDb3VudGVyKTtcblxuICBmdW5jdGlvbiBHb29nbGVBbmFseXRpY3MoKSB7XG4gICAgdmFyIGphdmFzY3JpcHRPYmplY3ROYW1lID0gYXJndW1lbnRzLmxlbmd0aCA8PSAwIHx8IGFyZ3VtZW50c1swXSA9PT0gdW5kZWZpbmVkID8gJ2dhJyA6IGFyZ3VtZW50c1swXTtcbiAgICB2YXIgcGFyYW1zID0gYXJndW1lbnRzLmxlbmd0aCA8PSAxIHx8IGFyZ3VtZW50c1sxXSA9PT0gdW5kZWZpbmVkID8ge30gOiBhcmd1bWVudHNbMV07XG5cbiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgR29vZ2xlQW5hbHl0aWNzKTtcblxuICAgIHZhciBfdGhpcyA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIE9iamVjdC5nZXRQcm90b3R5cGVPZihHb29nbGVBbmFseXRpY3MpLmNhbGwodGhpcywgamF2YXNjcmlwdE9iamVjdE5hbWUsIHBhcmFtcykpO1xuXG4gICAgX3RoaXMudHJhY2tlck5hbWUgPSBwYXJhbXMudHJhY2tlck5hbWUgfHwgJyc7XG4gICAgcmV0dXJuIF90aGlzO1xuICB9XG5cbiAgX2NyZWF0ZUNsYXNzKEdvb2dsZUFuYWx5dGljcywgW3tcbiAgICBrZXk6ICd0cmFjaycsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHRyYWNrKHBhcmFtcykge1xuICAgICAgaWYgKHR5cGVvZiBwYXJhbXMuYWN0aW9uID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICBfSW50ZW50QW5hbHl0aWNzLkludGVudEFuYWx5dGljcy5sb2dFcnJvcignTm8gYWN0aW9uIHN1cHBsaWVkIGZvciBHb29nbGVBbmFseXRpY3MudHJhY2s6ICcgKyBKU09OLnN0cmluZ2lmeShwYXJhbXMpKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdmFyIGZ1bmN0aW9uTmFtZSA9IHRoaXMudHJhY2tlclNlbmRQcmVmaXggKyAnc2VuZCc7XG5cbiAgICAgIHRoaXMuY291bnRlcihmdW5jdGlvbk5hbWUsIHtcbiAgICAgICAgJ2hpdFR5cGUnOiAnZXZlbnQnLFxuICAgICAgICAnZXZlbnRDYXRlZ29yeSc6IHBhcmFtcy5jYXRlZ29yeSB8fCAnY29tbW9uJyxcbiAgICAgICAgJ2V2ZW50QWN0aW9uJzogcGFyYW1zLmFjdGlvbixcbiAgICAgICAgJ2V2ZW50TGFiZWwnOiBwYXJhbXMubGFiZWwgfHwgdW5kZWZpbmVkLFxuICAgICAgICAnZXZlbnRWYWx1ZSc6IHBhcmFtcy52YWx1ZSB8fCB1bmRlZmluZWRcbiAgICAgIH0pO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogJ3NlbmRWYXJpYWJsZXMnLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBzZW5kVmFyaWFibGVzKHZhcmlhYmxlcykge1xuICAgICAgLy8hIEB0b2RvIFRoaW5rIG9mIGJpZyBkZXB0aCAtIGdhIGRvZXNuJ3QgYWNjZXB0IGl0LlxuICAgICAgdGhpcy5jb3VudGVyKHRoaXMudHJhY2tlclNlbmRQcmVmaXggKyAnc2V0JywgdmFyaWFibGVzKTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6ICd0cmFja2VyU2VuZFByZWZpeCcsXG4gICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICByZXR1cm4gdGhpcy50cmFja2VyTmFtZSB8fCAnJztcbiAgICB9XG4gIH1dKTtcblxuICByZXR1cm4gR29vZ2xlQW5hbHl0aWNzO1xufSkoX0Fic3RyYWN0Q291bnRlcjIuQWJzdHJhY3RDb3VudGVyKTtcblxuZXhwb3J0cy5Hb29nbGVBbmFseXRpY3MgPSBHb29nbGVBbmFseXRpY3M7XG5cbn0se1wiLi4vSW50ZW50QW5hbHl0aWNzXCI6MSxcIi4vQWJzdHJhY3RDb3VudGVyXCI6M31dLDU6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpe1xuJ3VzZSBzdHJpY3QnO1xuXG52YXIgX2NyZWF0ZUNsYXNzID0gKGZ1bmN0aW9uICgpIHsgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmIChcInZhbHVlXCIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9IHJldHVybiBmdW5jdGlvbiAoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7IGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH07IH0pKCk7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5leHBvcnRzLllhbmRleE1ldHJpa2EgPSB1bmRlZmluZWQ7XG5cbnZhciBfQWJzdHJhY3RDb3VudGVyMiA9IHJlcXVpcmUoJy4vQWJzdHJhY3RDb3VudGVyJyk7XG5cbnZhciBfSW50ZW50QW5hbHl0aWNzID0gcmVxdWlyZSgnLi4vSW50ZW50QW5hbHl0aWNzJyk7XG5cbmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvblwiKTsgfSB9XG5cbmZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHsgaWYgKCFzZWxmKSB7IHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcihcInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZFwiKTsgfSByZXR1cm4gY2FsbCAmJiAodHlwZW9mIGNhbGwgPT09IFwib2JqZWN0XCIgfHwgdHlwZW9mIGNhbGwgPT09IFwiZnVuY3Rpb25cIikgPyBjYWxsIDogc2VsZjsgfVxuXG5mdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSBcImZ1bmN0aW9uXCIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKFwiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCBcIiArIHR5cGVvZiBzdXBlckNsYXNzKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCBlbnVtZXJhYmxlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pOyBpZiAoc3VwZXJDbGFzcykgT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LnNldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKSA6IHN1YkNsYXNzLl9fcHJvdG9fXyA9IHN1cGVyQ2xhc3M7IH1cblxudmFyIFlhbmRleE1ldHJpa2EgPSAoZnVuY3Rpb24gKF9BYnN0cmFjdENvdW50ZXIpIHtcbiAgX2luaGVyaXRzKFlhbmRleE1ldHJpa2EsIF9BYnN0cmFjdENvdW50ZXIpO1xuXG4gIGZ1bmN0aW9uIFlhbmRleE1ldHJpa2EoamF2YXNjcmlwdE9iamVjdE5hbWUsIHBhcmFtcykge1xuICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBZYW5kZXhNZXRyaWthKTtcblxuICAgIHJldHVybiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBPYmplY3QuZ2V0UHJvdG90eXBlT2YoWWFuZGV4TWV0cmlrYSkuY2FsbCh0aGlzLCBqYXZhc2NyaXB0T2JqZWN0TmFtZSwgcGFyYW1zKSk7XG4gIH1cblxuICBfY3JlYXRlQ2xhc3MoWWFuZGV4TWV0cmlrYSwgW3tcbiAgICBrZXk6ICd0cmFjaycsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHRyYWNrKHBhcmFtcykge1xuICAgICAgaWYgKHR5cGVvZiBwYXJhbXMuZ29hbCA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgX0ludGVudEFuYWx5dGljcy5JbnRlbnRBbmFseXRpY3MubG9nRXJyb3IoJ05vIGdvYWwgc3VwcGxpZWQgZm9yIFlhbmRleE1ldHJpa2EudHJhY2s6ICcgKyBKU09OLnN0cmluZ2lmeShwYXJhbXMpKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdGhpcy5jb3VudGVyLnJlYWNoR29hbChwYXJhbXMuZ29hbCwgcGFyYW1zLnBhcmFtcyB8fCB7fSk7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiAnc2VuZFZhcmlhYmxlcycsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHNlbmRWYXJpYWJsZXModmFyaWFibGVzKSB7XG4gICAgICB0aGlzLmNvdW50ZXIucGFyYW1zKHZhcmlhYmxlcyk7XG4gICAgfVxuICB9XSk7XG5cbiAgcmV0dXJuIFlhbmRleE1ldHJpa2E7XG59KShfQWJzdHJhY3RDb3VudGVyMi5BYnN0cmFjdENvdW50ZXIpO1xuXG5leHBvcnRzLllhbmRleE1ldHJpa2EgPSBZYW5kZXhNZXRyaWthO1xuXG59LHtcIi4uL0ludGVudEFuYWx5dGljc1wiOjEsXCIuL0Fic3RyYWN0Q291bnRlclwiOjN9XX0se30sWzJdKVxuXG4iLCJpbXBvcnQge0dvb2dsZUFuYWx5dGljc30gZnJvbSAnLi9jb3VudGVycy9Hb29nbGVBbmFseXRpY3MnO1xuaW1wb3J0IHtZYW5kZXhNZXRyaWthfSBmcm9tICcuL2NvdW50ZXJzL1lhbmRleE1ldHJpa2EnO1xuXG5jbGFzcyBJbnRlbnRBbmFseXRpY3Mge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmRlZmF1bHRPcHRpb25zKCk7XG4gIH1cblxuICBkZWZhdWx0T3B0aW9ucygpIHtcbiAgICB0aGlzLmNvdW50ZXJzTGlzdCA9IHt9O1xuICAgIHRoaXMuYWN0aW9uUXVldWUgPSB7fTtcbiAgfVxuXG4gIGluaXQoY291bnRlcnNMaXN0KSB7XG4gICAgZm9yIChjb25zdCBjb3VudGVyVHlwZSBpbiBjb3VudGVyc0xpc3QpIHtcbiAgICAgIGlmIChjb3VudGVyc0xpc3QuaGFzT3duUHJvcGVydHkoY291bnRlclR5cGUpID09PSBmYWxzZSkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGNvdW50ZXIgPSBjb3VudGVyc0xpc3RbY291bnRlclR5cGVdO1xuICAgICAgY29uc3QgY291bnRlckNsYXNzID0gSW50ZW50QW5hbHl0aWNzLmNyZWF0ZUNvdW50ZXIoY291bnRlciwgY291bnRlclR5cGUpO1xuICAgICAgaWYgKGNvdW50ZXJDbGFzcyAhPT0gbnVsbCkge1xuICAgICAgICB0aGlzLmNvdW50ZXJzTGlzdFtjb3VudGVyVHlwZV0gPSBjb3VudGVyQ2xhc3M7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgc3RhdGljIGNyZWF0ZUNvdW50ZXIoY291bnRlciwgY291bnRlclR5cGUpIHtcbiAgICBzd2l0Y2ggKGNvdW50ZXJUeXBlKSB7XG4gICAgY2FzZSAnR29vZ2xlQW5hbHl0aWNzJzpcbiAgICAgIHJldHVybiBuZXcgR29vZ2xlQW5hbHl0aWNzKGNvdW50ZXIuamF2YXNjcmlwdE9iamVjdE5hbWUsIGNvdW50ZXIpO1xuICAgIGNhc2UgJ1lhbmRleE1ldHJpa2EnOlxuICAgICAgcmV0dXJuIG5ldyBZYW5kZXhNZXRyaWthKGNvdW50ZXIuamF2YXNjcmlwdE9iamVjdE5hbWUsIGNvdW50ZXIpO1xuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH1cblxuICBhZGRUb1F1ZXVlKGNvdW50ZXJUeXBlLCBmdW5jdGlvbk5hbWUsIGFyZ3VtZW50KSB7XG4gICAgaWYgKHR5cGVvZih0aGlzLmFjdGlvblF1ZXVlW2NvdW50ZXJUeXBlXSkgIT09ICdvYmplY3QnKSB7XG4gICAgICB0aGlzLmFjdGlvblF1ZXVlW2NvdW50ZXJUeXBlXSA9IFtdO1xuICAgIH1cbiAgICB0aGlzLmFjdGlvblF1ZXVlW2NvdW50ZXJUeXBlXS5wdXNoKHtcbiAgICAgICdmdW5jdGlvbk5hbWUnOiBmdW5jdGlvbk5hbWUsXG4gICAgICAnYXJndW1lbnQnOiBhcmd1bWVudCxcbiAgICB9KTtcbiAgfVxuXG4gIGNoZWNrVW5oYW5kbGVkKCkge1xuICAgIGZvciAoY29uc3QgY291bnRlclR5cGUgaW4gdGhpcy5hY3Rpb25RdWV1ZSkge1xuICAgICAgaWYgKHRoaXMuYWN0aW9uUXVldWUuaGFzT3duUHJvcGVydHkoY291bnRlclR5cGUpICYmIHR5cGVvZih0aGlzLmFjdGlvblF1ZXVlW2NvdW50ZXJUeXBlXSkgPT09ICdvYmplY3QnKSB7XG4gICAgICAgIC8vIC5jb3VudGVyIGdldHRlciB3aWxsIGNoZWNrIGlmIGNvdW50ZXIgZ2xvYmFsIG9iamVjdChpZS4gZ2EsIHlhQ291bnRlcikgbm93IGV4aXN0c1xuICAgICAgICBpZiAodGhpcy5jb3VudGVyc0xpc3QuaGFzT3duUHJvcGVydHkoY291bnRlclR5cGUpICYmIHRoaXMuY291bnRlcnNMaXN0W2NvdW50ZXJUeXBlXS5jb3VudGVyICE9PSBudWxsKSB7XG4gICAgICAgICAgLy8gbG9vcCB0aHJvdWdoIGFsbCBxdWV1ZUl0ZW1zIG9mIHRoaXMgY291bnRlclxuICAgICAgICAgIGNvbnN0IGNvdW50ZXJDbGFzcyA9IHRoaXMuY291bnRlcnNMaXN0W2NvdW50ZXJUeXBlXTtcbiAgICAgICAgICBmb3IgKGNvbnN0IHF1ZXVlSXRlbSBvZiB0aGlzLmFjdGlvblF1ZXVlW2NvdW50ZXJUeXBlXSkge1xuICAgICAgICAgICAgY29uc3QgZnVuY3Rpb25OYW1lID0gcXVldWVJdGVtLmZ1bmN0aW9uTmFtZTtcbiAgICAgICAgICAgIGNvbnN0IGFyZ3VtZW50ID0gcXVldWVJdGVtLmFyZ3VtZW50O1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgY291bnRlckNsYXNzW2Z1bmN0aW9uTmFtZV0oYXJndW1lbnQpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICBJbnRlbnRBbmFseXRpY3MubG9nRXJyb3IoYEV4Y2VwdGlvbiBkdXJpbmcgcXVldWVkICR7ZnVuY3Rpb25OYW1lfSBjYWxsOiAke0pTT04uc3RyaW5naWZ5KGUpfWApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICAvLyBkaXNhYmxlIHF1ZXVlIGZvciB0aGlzIGNvdW50ZXIgYXMgaXQgaXMgbm90IG5lZWRlZCBhbnltb3JlXG4gICAgICAgICAgLy8gYWxsIG5leHQgY2FsbHMgdG8gdGhpcyBjb3VudGVyIHNob3VsZCBiZSBoYW5kbGVkIG9rXG4gICAgICAgICAgdGhpcy5hY3Rpb25RdWV1ZVtjb3VudGVyVHlwZV0gPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHRyYWNrKGNvdW50ZXJzSW5zdHJ1Y3Rpb25zKSB7XG4gICAgdGhpcy5jaGVja1VuaGFuZGxlZCgpO1xuICAgIGZvciAoY29uc3QgY291bnRlclR5cGUgaW4gY291bnRlcnNJbnN0cnVjdGlvbnMpIHtcbiAgICAgIGlmIChjb3VudGVyc0luc3RydWN0aW9ucy5oYXNPd25Qcm9wZXJ0eShjb3VudGVyVHlwZSkgPT09IGZhbHNlKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBpbnN0cnVjdGlvbiA9IGNvdW50ZXJzSW5zdHJ1Y3Rpb25zW2NvdW50ZXJUeXBlXTtcbiAgICAgIGlmICh0aGlzLmNvdW50ZXJzTGlzdFtjb3VudGVyVHlwZV0uY291bnRlciA9PT0gbnVsbCkge1xuICAgICAgICAvLyBpZiBnbG9iYWwganMgb2JqZWN0IG9mIGNvdW50ZXIgaXMgbm90IGxvYWRlZCAtIHRoaXMgd2lsbCBhZGQgaXQgdG8gcXVldWVcbiAgICAgICAgdGhpcy5hZGRUb1F1ZXVlKGNvdW50ZXJUeXBlLCAndHJhY2snLCBpbnN0cnVjdGlvbik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAodGhpcy5jb3VudGVyc0xpc3QuaGFzT3duUHJvcGVydHkoY291bnRlclR5cGUpKSB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHRoaXMuY291bnRlcnNMaXN0W2NvdW50ZXJUeXBlXS50cmFjayhpbnN0cnVjdGlvbik7XG4gICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgSW50ZW50QW5hbHl0aWNzLmxvZ0Vycm9yKCdFeGNlcHRpb24gZHVyaW5nIHRyYWNrIGNhbGw6ICcgKyBKU09OLnN0cmluZ2lmeShlKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgc2VuZFZhcmlhYmxlcyh2YXJpYWJsZXMpIHtcbiAgICB0aGlzLmNoZWNrVW5oYW5kbGVkKCk7XG4gICAgZm9yIChjb25zdCBjb3VudGVyVHlwZSBpbiB0aGlzLmNvdW50ZXJzTGlzdCkge1xuICAgICAgaWYgKHRoaXMuY291bnRlcnNMaXN0Lmhhc093blByb3BlcnR5KGNvdW50ZXJUeXBlKSA9PT0gZmFsc2UpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBjb25zdCBjb3VudGVyID0gdGhpcy5jb3VudGVyc0xpc3RbY291bnRlclR5cGVdO1xuICAgICAgaWYgKGNvdW50ZXIuY291bnRlciA9PT0gbnVsbCkge1xuICAgICAgICB0aGlzLmFkZFRvUXVldWUoY291bnRlclR5cGUsICdzZW5kVmFyaWFibGVzJywgdmFyaWFibGVzKTtcbiAgICAgIH1cbiAgICAgIHRyeSB7XG4gICAgICAgIGNvdW50ZXIuc2VuZFZhcmlhYmxlcyh2YXJpYWJsZXMpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBJbnRlbnRBbmFseXRpY3MubG9nRXJyb3IoJ0V4Y2VwdGlvbiBkdXJpbmcgc2VuZFZhcmlhYmxlcyBjYWxsOiAnICsgSlNPTi5zdHJpbmdpZnkoZSkpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHN0YXRpYyBsb2dFcnJvcihtZXNzYWdlKSB7XG4gICAgLyplc2xpbnQtZGlzYWJsZSAqL1xuICAgIGlmICh0eXBlb2YoY29uc29sZSkgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICBjb25zb2xlLmxvZyhtZXNzYWdlKTtcbiAgICB9XG4gICAgLyplc2xpbnQtZW5hYmxlKi9cbiAgfVxufVxuXG5leHBvcnQge0ludGVudEFuYWx5dGljc307XG4iLCJpbXBvcnQge0ludGVudEFuYWx5dGljc30gZnJvbSAnLi9JbnRlbnRBbmFseXRpY3MnO1xuZ2xvYmFsLmludGVudEFuYWx5dGljcyA9IG5ldyBJbnRlbnRBbmFseXRpY3MoKTtcbiIsImNsYXNzIEFic3RyYWN0Q291bnRlciB7XG4gIC8vIEhlcmUgd2UgdHVybiBvZmYgbm8tdW51c2VkLXZhcnMgd2FybmluZyBiZWNhdXNlIHRoaXMgY2xhc3MgaXMgYWN0dWFsbHkgYWJzdHJhY3QuXG4gIC8vIFNvIHRoZXJlJ3MgYSBsb3Qgb2YgdW51c2VkIHZhcnMgYW5kIGl0IGlzIG5vcm1hbCAtIHdlIGp1c3Qgd2FudCB0byBkZXNjcmliZSB0aGUgd2hvbGUgaW50ZXJmYWNlLlxuICAvKiBlc2xpbnQgbm8tdW51c2VkLXZhcnM6IDAqL1xuICBjb25zdHJ1Y3RvcihqYXZhc2NyaXB0T2JqZWN0TmFtZSwgcGFyYW1zKSB7XG4gICAgdGhpcy5qYXZhc2NyaXB0T2JqZWN0TmFtZSA9IGphdmFzY3JpcHRPYmplY3ROYW1lO1xuICB9XG5cbiAgc3RhdGljIGdldENvdW50ZXJPYmplY3QoamF2YXNjcmlwdE9iamVjdE5hbWUpIHtcbiAgICByZXR1cm4gd2luZG93W2phdmFzY3JpcHRPYmplY3ROYW1lXSB8fCBudWxsO1xuICB9XG5cbiAgdHJhY2socGFyYW1zKSB7XG4gIH1cblxuICBzZW5kVmFyaWFibGVzKHZhcmlhYmxlcykge1xuXG4gIH1cblxuICBnZXQgY291bnRlcigpIHtcbiAgICByZXR1cm4gQWJzdHJhY3RDb3VudGVyLmdldENvdW50ZXJPYmplY3QodGhpcy5qYXZhc2NyaXB0T2JqZWN0TmFtZSk7XG4gIH1cblxufVxuXG5leHBvcnQge0Fic3RyYWN0Q291bnRlcn07XG4iLCJpbXBvcnQge0Fic3RyYWN0Q291bnRlcn0gZnJvbSAnLi9BYnN0cmFjdENvdW50ZXInO1xuaW1wb3J0IHtJbnRlbnRBbmFseXRpY3N9IGZyb20gJy4uL0ludGVudEFuYWx5dGljcyc7XG5cbmNsYXNzIEdvb2dsZUFuYWx5dGljcyBleHRlbmRzIEFic3RyYWN0Q291bnRlciB7XG4gIGNvbnN0cnVjdG9yKGphdmFzY3JpcHRPYmplY3ROYW1lID0gJ2dhJywgcGFyYW1zID0ge30pIHtcbiAgICBzdXBlcihqYXZhc2NyaXB0T2JqZWN0TmFtZSwgcGFyYW1zKTtcbiAgICB0aGlzLnRyYWNrZXJOYW1lID0gcGFyYW1zLnRyYWNrZXJOYW1lIHx8ICcnO1xuICB9XG5cbiAgZ2V0IHRyYWNrZXJTZW5kUHJlZml4KCkge1xuICAgIHJldHVybiB0aGlzLnRyYWNrZXJOYW1lIHx8ICcnO1xuICB9XG5cbiAgdHJhY2socGFyYW1zKSB7XG4gICAgaWYgKHR5cGVvZihwYXJhbXMuYWN0aW9uKSA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIEludGVudEFuYWx5dGljcy5sb2dFcnJvcignTm8gYWN0aW9uIHN1cHBsaWVkIGZvciBHb29nbGVBbmFseXRpY3MudHJhY2s6ICcgKyBKU09OLnN0cmluZ2lmeShwYXJhbXMpKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgZnVuY3Rpb25OYW1lID0gdGhpcy50cmFja2VyU2VuZFByZWZpeCArICdzZW5kJztcblxuICAgIHRoaXMuY291bnRlcihmdW5jdGlvbk5hbWUsIHtcbiAgICAgICdoaXRUeXBlJzogJ2V2ZW50JyxcbiAgICAgICdldmVudENhdGVnb3J5JzogcGFyYW1zLmNhdGVnb3J5IHx8ICdjb21tb24nLFxuICAgICAgJ2V2ZW50QWN0aW9uJzogcGFyYW1zLmFjdGlvbixcbiAgICAgICdldmVudExhYmVsJzogcGFyYW1zLmxhYmVsIHx8IHVuZGVmaW5lZCxcbiAgICAgICdldmVudFZhbHVlJzogcGFyYW1zLnZhbHVlIHx8IHVuZGVmaW5lZCxcbiAgICB9KTtcbiAgfVxuXG4gIHNlbmRWYXJpYWJsZXModmFyaWFibGVzKSB7XG4gICAgLy8hIEB0b2RvIFRoaW5rIG9mIGJpZyBkZXB0aCAtIGdhIGRvZXNuJ3QgYWNjZXB0IGl0LlxuICAgIHRoaXMuY291bnRlcih0aGlzLnRyYWNrZXJTZW5kUHJlZml4ICsgJ3NldCcsIHZhcmlhYmxlcyk7XG4gIH1cbn1cblxuZXhwb3J0IHtHb29nbGVBbmFseXRpY3N9O1xuIiwiaW1wb3J0IHtBYnN0cmFjdENvdW50ZXJ9IGZyb20gJy4vQWJzdHJhY3RDb3VudGVyJztcbmltcG9ydCB7SW50ZW50QW5hbHl0aWNzfSBmcm9tICcuLi9JbnRlbnRBbmFseXRpY3MnO1xuXG5jbGFzcyBZYW5kZXhNZXRyaWthIGV4dGVuZHMgQWJzdHJhY3RDb3VudGVyIHtcbiAgY29uc3RydWN0b3IoamF2YXNjcmlwdE9iamVjdE5hbWUsIHBhcmFtcykge1xuICAgIHN1cGVyKGphdmFzY3JpcHRPYmplY3ROYW1lLCBwYXJhbXMpO1xuICB9XG5cbiAgdHJhY2socGFyYW1zKSB7XG4gICAgaWYgKHR5cGVvZihwYXJhbXMuZ29hbCkgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICBJbnRlbnRBbmFseXRpY3MubG9nRXJyb3IoJ05vIGdvYWwgc3VwcGxpZWQgZm9yIFlhbmRleE1ldHJpa2EudHJhY2s6ICcgKyBKU09OLnN0cmluZ2lmeShwYXJhbXMpKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5jb3VudGVyLnJlYWNoR29hbChcbiAgICAgIHBhcmFtcy5nb2FsLFxuICAgICAgcGFyYW1zLnBhcmFtcyB8fCB7fVxuICAgICk7XG4gIH1cblxuICBzZW5kVmFyaWFibGVzKHZhcmlhYmxlcykge1xuICAgIHRoaXMuY291bnRlci5wYXJhbXModmFyaWFibGVzKTtcbiAgfVxufVxuXG5leHBvcnQge1lhbmRleE1ldHJpa2F9O1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
